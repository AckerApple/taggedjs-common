var e={d:(t,r)=>{for(var n in r)e.o(r,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:r[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)},t={};function r(e){const t={beforeRender:e.beforeRender||(()=>{}),beforeRedraw:e.beforeRedraw||(()=>{}),afterRender:e.afterRender||(()=>{}),beforeDestroy:e.beforeDestroy||(()=>{})};r.tagUse.push(t)}function n(e,t){r.tagUse.forEach((r=>r.afterRender(e,t)))}function o(e){return a(e,new WeakMap)}function a(e,t){if(null===e||"object"!=typeof e)return e;if(t.has(e))return t.get(e);if(e instanceof Date)return new Date(e);if(e instanceof RegExp)return new RegExp(e);const r=Array.isArray(e)?[]:Object.create(Object.getPrototypeOf(e));if(t.set(e,r),Array.isArray(e))for(let n=0;n<e.length;n++)r[n]=a(e[n],t);else for(const n in e)e.hasOwnProperty(n)&&(r[n]=a(e[n],t));return r}function s(e,t){return i(e,t,new WeakMap)}function i(e,t,r){if(e===t||(o=t,(n=e)instanceof Function&&o instanceof Function&&n.toString()===o.toString()))return!0;var n,o;if("object"!=typeof e||"object"!=typeof t||null===e||null===t)return!1;const a=Object.keys(e),s=Object.keys(t);if(a.length!==s.length)return!1;if(r.has(e))return!0;r.set(e,0);for(const n of a)if(!s.includes(n)||!i(e[n],t[n],r))return!1;if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(!i(e[n],t[n],r))return!1}else if(Array.isArray(e)||Array.isArray(t))return!1;return!0}function c(e){e.tagSupport.memory.providers.filter((e=>!s(e.instance,e.clone))).forEach((t=>{!function(e,t){u(e,t).forEach((({tag:e,renderCount:t,provider:r})=>{t===e.tagSupport.memory.renderCount&&(r.clone=o(r.instance),e.tagSupport.render())}))}(e.getAppElement(),t),t.clone=o(t.instance)}))}function u(e,t,r=[]){const n=e.tagSupport.memory.providers.find((e=>e.constructMethod===t.constructMethod));return n&&r.push({tag:e,renderCount:e.tagSupport.memory.renderCount,provider:n}),e.children.forEach((e=>u(e,t,r))),r}e.d(t,{xH:()=>$,Ly:()=>k,TY:()=>U}),r.tagUse=[],r.memory={};const l=[];function p(e,t){const r=e.indexOf(t);-1!==r&&e.splice(r,1)}const f={globalSubCount$:new class{value;isSubject=!0;subscribers=[];constructor(e){this.value=e}subscribe(e){this.subscribers.push(e),f.globalSubs.push(e);const t=f.globalSubCount$;f.globalSubCount$.set(t.value+1);const r=()=>{r.unsubscribe()};return r.unsubscribe=()=>{p(this.subscribers,e),p(f.globalSubs,e),f.globalSubCount$.set(t.value-1),r.unsubscribe=()=>{}},r}set(e){this.value=e,this.subscribers.forEach((t=>{t.value=e,t(e)}))}next=this.set}(0),globalSubs:[]};new class{};class g extends Error{details;constructor(e,t,r={}){super(e),this.name=g.name,this.details={...r,errorCode:t}}}class d extends g{constructor(e,t){super(e,"state-mismatch-error",t),this.name=d.name}}var m;!function(e){e.tag="tag",e.tagArray="tag-array",e.tagComponent="tag-component",e.value="value"}(m||(m={}));const y="__tagvar",b="--"+y+"--";new RegExp(y,"g"),new RegExp(b,"g"),r.memory.stateConfig={array:[],rearray:[]};const h=[];r({beforeRender:e=>w(e),beforeRedraw:e=>w(e),afterRender:e=>{const t=e.memory.state,n=r.memory.stateConfig;if(n.rearray.length&&n.rearray.length!==n.array.length){const t=`States lengths mismatched ${n.rearray.length} !== ${n.array.length}`;throw new d(t,{oldStates:n.array,newStates:n.rearray,component:e.templater?.wrapper.original})}n.rearray=[],t.newest=[...n.array],n.array=[],h.forEach((e=>e())),h.length=0}});function w(e){const t=e.memory.state,n=r.memory.stateConfig;if(n.rearray.length){const r="last array not cleared";throw console.error(r,{config:n,component:e.templater?.wrapper.original,state:t,expectedClearArray:n.rearray}),new d(r,{config:n,component:e.templater?.wrapper.original,state:t,expectedClearArray:n.rearray})}n.rearray=[],t?.newest.length&&n.rearray.push(...t.newest)}function v(e,t){const n=r.memory.providerConfig;n.ownerTag=t,e.memory.providers.length&&(n.providers.length=0,n.providers.push(...e.memory.providers))}function S(e){r.memory.initCurrentSupport=e}let C;HTMLElement,r.memory.providerConfig={providers:[],ownerTag:void 0},r({beforeRender:(e,t)=>{v(e,t)},beforeRedraw:(e,t)=>{v(e,t.ownerTag)},afterRender:e=>{const t=r.memory.providerConfig;e.memory.providers=[...t.providers],t.providers.length=0}}),r({beforeRender:e=>S(e),beforeRedraw:e=>S(e)}),r({beforeRender:e=>C=e,beforeRedraw:e=>C=e,beforeDestroy:(e,t)=>{const r=e.memory.destroyCallback;r&&r()}});r({beforeRender:e=>{},beforeRedraw:e=>{}});const E={},R={};function A(e){const{id:t,observer:r,tag:n}=e;r.disconnect(),n.destroy(),delete E[t]}function x(e){return"__tagTemplate_"+function(e){let t=e.toString().replace(/\s+/g,"_").replace(/[^\w\d]/g,"_");return/^[a-zA-Z]/.test(t)||(t="fn_"+t),t}(e)}function O(e){const t=e.getAttribute("props");if(!t)return{element:e};try{const r=JSON.parse(t),n=e.getAttribute("events");n&&n.split(",").map((e=>e.trim())).map((e=>{r[e]=t=>o(e,{detail:{[e]:t}})}));const o=function(t,r){const n=new CustomEvent(t,r);e.dispatchEvent(n)};return r}catch(r){throw console.warn("Failed to parse props on element",{element:e,propsString:t}),r}}function T(e,t,o){const a=t.gateway;if(a)return a.updateTag(),a;const s=O(t);try{const{tag:a}=function(e,t,o){const a=l.findIndex((e=>e.element===t));a>=0&&(l[a].tag.destroy(),l.splice(a,1),console.warn("Found and destroyed app element already rendered to element",{element:t}));const s=function(e){const t=e.tagSupport;!function(e,t){r.tagUse.forEach((t=>t.beforeRender(e,void 0)))}(t);const o=e.wrapper();return n(t,o),{tag:o,tagSupport:t}}(e(o)),{tag:i,tagSupport:u}=s;i.appElement=t,i.tagSupport.oldest=i,function(e,t){let o=t;e.mutatingRender=()=>{const a=e.memory.renderCount;if(c(t),a!==e.memory.renderCount)return o;!function(e,t){r.tagUse.forEach((r=>r.beforeRedraw(e,t)))}(t.tagSupport,t);const s=e.templater,i=o=s.wrapper();return i.tagSupport.memory=e.memory,e.propsConfig={...i.tagSupport.propsConfig},t.tagSupport.newest=i,n(t.tagSupport,t),e.oldest.updateByTag(i),e.newest=i,o}}(i.tagSupport,i);const p=document.createElement("template");return p.setAttribute("tag-detail","app-template-placeholder"),t.appendChild(p),i.buildBeforeElement(p),t.setUse=e.original.setUse,l.push({element:t,tag:i}),{tag:i,tags:e.original.tags}}(o,t,s);return function(e,t,r,n){const o=new MutationObserver((e=>{if(function(e){const{element:t}=e;if(!document.body.contains(t))return A(e),!1}(s))for(const t of e)"attributes"===t.type&&a()}));function a(){const e=r.tagSupport.templater,n=e.tagSupport.propsConfig.latest,o=O(t);e.tagSupport.propsConfig.latest=o,JSON.stringify(n)===JSON.stringify(o)||(e.tagSupport.propsConfig.latest=o)}k(n);const s={id:e,tag:r,observer:o,component:n,element:t,updateTag:a};return E[e]=E[e]||[],E[e].push(s),t.gateway=s,o.observe(t,{attributes:!0}),s}(e,t,a,o)}catch(e){throw console.warn("Failed to render component to element",{component:o,element:t,props:s}),e}}class j extends HTMLElement{gateway;constructor(){super(),setTimeout((()=>this.gateway=function(e){const t=e.id||e.getAttribute("id");if(!t){const r="Cannot check a tag on element with no id attribute";throw console.warn(r,{id:t,element:e}),new Error(r)}const r=R[t];if(!r){const r=`Cannot find a tag registered by id of ${t}`;throw console.warn(r,{id:t,element:e}),new Error(r)}return T(t,e,r)}(this)),0)}disconnectedCallback(){A(this.gateway)}}function $(){customElements.define("tag-element",j)}let _=!1;function k(e){if(!_){try{$()}catch(e){throw e}_=!0}const t=x(e);return R[t]=e,t}const M={},U=function(e){const t=x(e);if(M[t])return M[t];let r,n=0;function o(){const n=function(e,t){return function(e,t,r){return t.forEach((t=>T(e,t,r))),t}(e,document.querySelectorAll("#"+e),t)}(t,e);return n.length?(r&&clearInterval(r),delete M[t],n.length):n.length}return o()?{id:t}:(r=setInterval((()=>{if(n+=5,n>=2e3)throw clearInterval(r),new Error(`TaggedJs Element ${t} not found`);o()}),5),M[t]={id:t},M[t])};var D=t.xH,F=t.Ly,H=t.TY;export{D as initWebComponents,F as loadTagGateway,H as tagGateway};